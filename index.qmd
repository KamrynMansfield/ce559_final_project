---
title: Effectiveness of WMATA Confidential Close Call Reporting System
author:
  - name: Kamryn Mansfield
    orcid: 0009-0003-5466-0821
    corresponding: true
    email: kmansfi4@vols.utk.edu
    roles:
      - Investigation
      - Project administration
      - Software
      - Visualization
    affiliations:
      - University of Tennessee
keywords:
  - WMATA
  - Close Call
  - Public Transit 
  - Safety
  - Transit Safety
abstract: |
  Here is where the abstract will be
key-points:
  - Point 1
  - Point 2
date: last-modified
bibliography: references.bib
number-sections: true
---


```{r}
library(tidytext)
library(tidyverse)
library(wordcloud)
library(pdftools)
library(readxl)
```


## Literature Search
```{r}
search_tbl <- read_excel("notebooks/data/lit_search.xlsx")

lit_tbl <- read_excel("notebooks/data/lit_review_table.xlsx") 
```

To find research on the effectiveness of close call reporting, I performed a systematic search for studies on close call reporting and proactive safety implementation. The main database I search in was Google Scholar with a few search results from the Scotus database. @tbl-search shows the search phrases and results for each database. My initial search resulted in `r sum(search_tbl$Results)` studies. 
To find the most relevant studies, I had one round of reviewing each study's abstract and title to exclude studies obviously not related. This left me with 90 studies to sort through. I did a second round of review to look more in depth at the remaining 90 studies, and exclude more studies that were not relevant. This left me with the final `r nrow(lit_tbl)` studies I used in my literature review. 

The criteria I used to determine a study's relevance were as follows:

- Discussion on close call safety reporting systems on public transit

- Discussion on other safety measures taken to proactively avoid crashes on public transit

## Literature Summary

@tbl-lit-review summarizes the findings from the studies by describing the main mode that was analyzed and the safety measure that was used. There were seven studies that focused on close call or near misses, while the rest of the studies focused on other methods to proactively make safety improvements. Three of the studies focused on worker-related metrics, two focused on crowdsourced data, and the rest focused on some type of technological or statistical method to prevent safety incidents. 

One interesting study to point out was @xu_estimating_2024. In their New York study, the estimated the ratio of near misses to crashes in urban areas to be about 1957:1. This study was the closest to quantifying the effects of close call / near-miss data. The rest of the studies were either data summaries or case studies.

## Research Gaps
While there is a lot of recent research being done on technology to detect near- misses, there are hardly any studies that quantify the effectiveness of improvements made as a result of the near-miss data. There is even less research in this area done specifically for publich transit.

In their study, @buckley_developing_2012 reviewed the close call reporting system implemented by WMATA, but it was only a case study to describe the organizational changes and safety cultural shifts in the agency. Due to the lack in research on the safety benefits of gathering close call data, this study will contribute to the field of transportaiton safety in important ways. 


```{r}

pdf_to_tidytext <- function(folder_of_pdfs){
  files <- list.files(folder_of_pdfs, full.names = T)
  listed_dfs <- list()
  non_pdfs <- 0
  for (file in files){
    if(tools::file_ext(file) == "pdf"){
      file_name <- basename(file)
      text <- pdf_text(file)
      df <- data.frame(file_name = file_name,
                       text = text)
      listed_dfs[[file_name]] <- df
    } else{
      non_pdfs <- non_pdfs + 1 
    }
  }
  
  combined_dfs <- dplyr::bind_rows(listed_dfs)
  
  tidytext_df <- combined_dfs |>
    unnest_tokens(word, text) |>
    group_by(file_name, word) |>
    summarise(count = n()) |>
    bind_tf_idf(word, file_name, count)
  
  tidytext_df <- tidytext_df |>
    group_by(file_name) |>
    arrange(desc(tf_idf)) |>
    ungroup()
  
  if(non_pdfs > 0){
    message(paste(non_pdfs,"files were not PDFs and were excluded"))
  }
  
  return(tidytext_df)
  
}

safety_lit <- pdf_to_tidytext("notebooks/data/pdfs/")

unimportant_words <- c("the",
                       "and",
                       "of",
                       "to",
                       "a",
                       "in",
                       "for",
                       "is",
                       "that",
                       "on",
                       "with",
                       "as",
                       "or",
                       "are",
                       "this",
                       "data",
                       "by",
                       "be",
                       "from",
                       "an",
                       "at",
                       "1",
                       "2",
                       "nottem3",
                       "was",
                       "research",
                       "can",
                       "were",
                       "it",
                       "time",
                       "these",
                       "figure",
                       "more",
                       "4",
                       "have",
                       "analysis",
                       "based",
                       "5",
                       "which",
                       "use",
                       "other",
                       "their",
                       "may",
                       "al",
                       "et",
                       "all",
                       "https",
                       "using",
                       "also",
                       "such",
                       "study",
                       "used",
                       "they",
                       "has",
                       "i",
                       "between",
                       "when",
                       "s",
                       "will",
                       "one",
                       "table",
                       "factors",
                       "no",
                       "each",
                       "report",
                       "how",
                       "than",
                       "10",
                       "m",
                       "through",
                       "not",
                       "3",
                       "its",
                       "if",
                       "high",
                       "two",
                       "section",
                       "j",
                       "models",
                       "into",
                       "but",
                       "0",
                       "while",
                       "6",
                       "review",
                       "c",
                       "7",
                       "there",
                       "should",
                       "where",
                       "most",
                       "b",
                       "been",
                       "p",
                       "doi.org",
                       "8",
                       "some",
                       "2024",
                       "x",
                       "3",
                       "2023",
                       "would",
                       "only",
                       "c",
                       "any",
                       "both"
                       )

unique_words <- safety_lit |>
  group_by(word) |>
  summarise(count = sum(count),
            tf_idf = sum(tf_idf)) |>
  arrange(desc(count))

unique_words_filtered <- unique_words |> 
  filter(!word %in% unimportant_words)

```


```{r}
#| label: tbl-search
#| tbl-cap: Search databases, inputs, and results
#| tbl-alt: Search databases, inputs, and results

knitr::kable(search_tbl)

```

```{r}
#| label: tbl-lit-review
#| tbl-cap: Literature Search Summary
#| tbl-alt: Table summarizing literature search

lit_tbl <- lit_tbl |>
  select(Reference, `Mode Focus`, "Safety Measure")

knitr::kable(lit_tbl)

```

## References {.unnumbered}

:::{#refs}

:::


## Appendix


```{r}
#| label: fig-word-freq
#| fig-cap: Top 20 most frequent words in the articles (excluding common words)
#| fig-alt: Top 20 most frequent words in the articles (excluding common words)

unique_words_filtered |>
  head(20) |>
  ggplot() +
  geom_col(aes(x = count, y = fct_reorder(word, count))) +
  labs(y = "Word",
       x = "Count") +
  theme_minimal()
```

```{r}
#| label: fig-word-map
#| fig-cap: Top 20 most frequent words in a word map
#| fig-alt: Top 20 most frequent words in the articles. Displayed as a word map.

wordcloud(words = unique_words_filtered$word, freq = unique_words_filtered$count,
          min.freq = 1, # Minimum frequency for a word to be shown
          max.words = 50, # Maximum number of words
          colors = brewer.pal(8, "Dark2"))
```
